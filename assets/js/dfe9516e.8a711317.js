"use strict";(self.webpackChunkdocusaurus_2=self.webpackChunkdocusaurus_2||[]).push([[2187],{3905:(a,o,e)=>{e.d(o,{Zo:()=>l,kt:()=>g});var r=e(7294);function t(a,o,e){return o in a?Object.defineProperty(a,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[o]=e,a}function s(a,o){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),e.push.apply(e,r)}return e}function n(a){for(var o=1;o<arguments.length;o++){var e=null!=arguments[o]?arguments[o]:{};o%2?s(Object(e),!0).forEach((function(o){t(a,o,e[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):s(Object(e)).forEach((function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(e,o))}))}return a}function i(a,o){if(null==a)return{};var e,r,t=function(a,o){if(null==a)return{};var e,r,t={},s=Object.keys(a);for(r=0;r<s.length;r++)e=s[r],o.indexOf(e)>=0||(t[e]=a[e]);return t}(a,o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(r=0;r<s.length;r++)e=s[r],o.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(a,e)&&(t[e]=a[e])}return t}var m=r.createContext({}),p=function(a){var o=r.useContext(m),e=o;return a&&(e="function"==typeof a?a(o):n(n({},o),a)),e},l=function(a){var o=p(a.components);return r.createElement(m.Provider,{value:o},a.children)},d="mdxType",c={inlineCode:"code",wrapper:function(a){var o=a.children;return r.createElement(r.Fragment,{},o)}},u=r.forwardRef((function(a,o){var e=a.components,t=a.mdxType,s=a.originalType,m=a.parentName,l=i(a,["components","mdxType","originalType","parentName"]),d=p(e),u=t,g=d["".concat(m,".").concat(u)]||d[u]||c[u]||s;return e?r.createElement(g,n(n({ref:o},l),{},{components:e})):r.createElement(g,n({ref:o},l))}));function g(a,o){var e=arguments,t=o&&o.mdxType;if("string"==typeof a||t){var s=e.length,n=new Array(s);n[0]=u;var i={};for(var m in o)hasOwnProperty.call(o,m)&&(i[m]=o[m]);i.originalType=a,i[d]="string"==typeof a?a:t,n[1]=i;for(var p=2;p<s;p++)n[p]=e[p];return r.createElement.apply(null,n)}return r.createElement.apply(null,e)}u.displayName="MDXCreateElement"},3643:(a,o,e)=>{e.r(o),e.d(o,{assets:()=>m,contentTitle:()=>n,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var r=e(7462),t=(e(7294),e(3905));const s={sidebar_position:1},n="Face Superposition Normalization",i={unversionedId:"processamento-imagens/face-superposition-normalization",id:"processamento-imagens/face-superposition-normalization",title:"Face Superposition Normalization",description:"Esse projeto tem como objetivo ajustar um conjunto de fotos de rostos a fim de criar uma sobreposi\xe7\xe3o padr\xe3o entre elas.",source:"@site/docs/processamento-imagens/face-superposition-normalization.md",sourceDirName:"processamento-imagens",slug:"/processamento-imagens/face-superposition-normalization",permalink:"/docs/processamento-imagens/face-superposition-normalization",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/processamento-imagens/face-superposition-normalization.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Processamento de Imagens",permalink:"/docs/category/processamento-de-imagens"},next:{title:"Mapa de Intensidade com conta-gotas",permalink:"/docs/processamento-imagens/mapa-conta-gotas"}},m={},p=[{value:"Motiva\xe7\xe3o",id:"motiva\xe7\xe3o",level:2},{value:"Demonstra\xe7\xe3o",id:"demonstra\xe7\xe3o",level:2},{value:"Como funciona?",id:"como-funciona",level:2},{value:"Primeiro passo: achar as coordenadas dos olhos",id:"primeiro-passo-achar-as-coordenadas-dos-olhos",level:3},{value:"Segundo passo: rotacionar a imagem para manter a linha do rosto horizontal",id:"segundo-passo-rotacionar-a-imagem-para-manter-a-linha-do-rosto-horizontal",level:3},{value:"Terceiro passo: redimensionar a foto e colocar na posi\xe7\xe3o padr\xe3o",id:"terceiro-passo-redimensionar-a-foto-e-colocar-na-posi\xe7\xe3o-padr\xe3o",level:3},{value:"Problemas",id:"problemas",level:2}],l={toc:p},d="wrapper";function c(a){let{components:o,...e}=a;return(0,t.kt)(d,(0,r.Z)({},l,e,{components:o,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"face-superposition-normalization"},"Face Superposition Normalization"),(0,t.kt)("p",null,"Esse projeto tem como objetivo ajustar um conjunto de fotos de rostos a fim de criar uma sobreposi\xe7\xe3o padr\xe3o entre elas.\nO c\xf3digo pode ser encontrado no ",(0,t.kt)("a",{parentName:"p",href:"https://github.com/diogohal/face-superposition-normalization"},"reposit\xf3rio GitHub"),"."),(0,t.kt)("h2",{id:"motiva\xe7\xe3o"},"Motiva\xe7\xe3o"),(0,t.kt)("p",null,"A principal motiva\xe7\xe3o para esse projeto foi automatizar a gera\xe7\xe3o de fotos para um efeito de time-lapse. Em 2021, eu deixei meu cabelo crescer e, durante o ano, tirei uma foto por dia do meu rosto. O intuito era criar um v\xeddeo time-lapse no \xfaltimo dia do ano para observar a evolu\xe7\xe3o. Na \xe9poca, eu n\xe3o conhecia ferramentas que poderiam fazer isso, e como eu tamb\xe9m n\xe3o sabia programar, fiz a edi\xe7\xe3o de todas as 365 fotos na m\xe3o, o que me tomou muitas horas."),(0,t.kt)("p",null,"O v\xeddeo do time-lapse pode ser encontrado no meu perfil do ",(0,t.kt)("a",{parentName:"p",href:"https://instagram.com/diogohal"},"Instagram"),"."),(0,t.kt)("h2",{id:"demonstra\xe7\xe3o"},"Demonstra\xe7\xe3o"),(0,t.kt)("p",null,"Ap\xf3s clonar o reposit\xf3rio, podem ser encontradas as 9 primeiras fotos do v\xeddeo na pasta ",(0,t.kt)("strong",{parentName:"p"},"test_samples"),". A pasta ",(0,t.kt)("strong",{parentName:"p"},"result_samples")," cont\xe9m as imagens ap\xf3s a transforma\xe7\xe3o.\nPara rodar o programa, use a linha de comando:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"python face-superposition-normalization.py -i test_samples -o test_results\n")),(0,t.kt)("p",null,"onde ",(0,t.kt)("strong",{parentName:"p"},"-i")," \xe9 a pasta de entrada e ",(0,t.kt)("strong",{parentName:"p"},"-o")," a pasta de sa\xedda. Outras argumentos podem ser usados:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-h")," ou ",(0,t.kt)("strong",{parentName:"li"},"--help:")," Imprime um guia no terminal."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-i")," ou ",(0,t.kt)("strong",{parentName:"li"},"--input-folder:")," Caminho para a pasta que cont\xe9m as imagens de entrada."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-o")," ou ",(0,t.kt)("strong",{parentName:"li"},"--output-folder:")," Caminho para a pasta onde as imagens normalizadas ser\xe3o salvas."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-d")," ou ",(0,t.kt)("strong",{parentName:"li"},"--default-image:")," O nome da imagem que servir\xe1 como padr\xe3o para a normaliza\xe7\xe3o. Padr\xe3o: a primeira imagem."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-q")," ou ",(0,t.kt)("strong",{parentName:"li"},"--quantity:")," A quantidade de imagens que ser\xe3o normalizadas. Padr\xe3o: todas as imagens."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-s")," ou ",(0,t.kt)("strong",{parentName:"li"},"--size-ratio:")," Valor usado para redimensionar as imagens de entrada. Padr\xe3o: 1.0."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"-l")," ou ",(0,t.kt)("strong",{parentName:"li"},"--lines:")," Desenha linhas horizontais e verticais das interse\xe7\xf5es da posi\xe7\xe3o dos olhos.")),(0,t.kt)("h2",{id:"como-funciona"},"Como funciona?"),(0,t.kt)("p",null,"A l\xf3gica por tr\xe1s do c\xf3digo baseia-se na posi\xe7\xe3o dos olhos. A ideia \xe9 reposicion\xe1-los em um local padr\xe3o para que os rostos fiquem sobrepostos. Para isso, foi utilizado um modelo pr\xe9-treinado para a detec\xe7\xe3o dos olhos, o Haar Cascade."),(0,t.kt)("h3",{id:"primeiro-passo-achar-as-coordenadas-dos-olhos"},"Primeiro passo: achar as coordenadas dos olhos"),(0,t.kt)("p",null,"O modelo retorna uma caixa com as posi\xe7\xf5es de cada olho encontrado, fornecendo tr\xeas informa\xe7\xf5es: as coordenadas ",(0,t.kt)("strong",{parentName:"p"},"(x, y)")," do canto superior esquerdo da caixa, a dist\xe2ncia horizontal ",(0,t.kt)("strong",{parentName:"p"},"h")," at\xe9 o canto superior direito e a dist\xe2ncia vertical ",(0,t.kt)("strong",{parentName:"p"},"v")," at\xe9 o canto inferior esquerdo. Em outras palavras, as coordenadas dos quatro cantos dessa caixa s\xe3o ",(0,t.kt)("strong",{parentName:"p"},"(x, y)"),", ",(0,t.kt)("strong",{parentName:"p"},"(x+h, y)"),", ",(0,t.kt)("strong",{parentName:"p"},"(x, y+v)")," e ",(0,t.kt)("strong",{parentName:"p"},"(x+h, y+v)"),". Usando um c\xe1lculo de m\xe9dia simples, podemos estimar as coordenadas do ponto central dos olhos."),(0,t.kt)("h3",{id:"segundo-passo-rotacionar-a-imagem-para-manter-a-linha-do-rosto-horizontal"},"Segundo passo: rotacionar a imagem para manter a linha do rosto horizontal"),(0,t.kt)("p",null,"Agora que temos as informa\xe7\xf5es das coordenadas dos dois olhos, podemos calcular o \xe2ngulo entre eles e realizar uma rota\xe7\xe3o para alinhar os olhos horizontalmente. Isso envolve o uso de propriedades trigonom\xe9tricas, uma vez que as posi\xe7\xf5es dos olhos formam um tri\xe2ngulo ret\xe2ngulo. Podemos calcular a tangente e, em seguida, usar a tangente inversa para encontrar o \xe2ngulo correto. Por fim, aplicamos essa rota\xe7\xe3o \xe0 imagem."),(0,t.kt)("h3",{id:"terceiro-passo-redimensionar-a-foto-e-colocar-na-posi\xe7\xe3o-padr\xe3o"},"Terceiro passo: redimensionar a foto e colocar na posi\xe7\xe3o padr\xe3o"),(0,t.kt)("p",null,"Agora precisamos redimensionar a imagem para atender \xe0 propor\xe7\xe3o padr\xe3o. Lembre-se de que, se esta for a primeira imagem a ser analisada, ela se tornar\xe1 o padr\xe3o. Para fazer isso, basta encontrar a raz\xe3o entre a dist\xe2ncia dos olhos padr\xe3o e a dist\xe2ncia dos olhos na imagem em an\xe1lise. Essa raz\xe3o \xe9 usada para redimensionar a foto. Por fim, basta posicionar os olhos nas mesmas coordenadas das posi\xe7\xf5es padr\xe3o dos olhos, o que resulta na sobreposi\xe7\xe3o das imagens."),(0,t.kt)("h2",{id:"problemas"},"Problemas"),(0,t.kt)("p",null,"Por vezes o modelo de detec\xe7\xe3o do Haar Cascade tem problemas em encontrar os olhos. Em an\xe1lises emp\xedricas, notei que algumas vezes encontrava-se apenas um olho e, em outros momentos, confundia-se uma das narinas com um dos olhos. No primeiro caso, o algoritmo para a execu\xe7\xe3o do programa, j\xe1 no segundo ele realiza as transforma\xe7\xf5es de forma err\xf4nea. Al\xe9m disso, imagens muito grandes aparentam apresentar uma maior ocorr\xeancia desses erros."))}c.isMDXComponent=!0}}]);